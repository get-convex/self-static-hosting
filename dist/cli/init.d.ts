#!/usr/bin/env node
/**
 * Output integration instructions for LLMs.
 *
 * Usage:
 *   npx @convex-dev/self-static-hosting init
 */
declare const instructions = "\n# Convex Self Static Hosting - Integration Instructions\n\nYou are integrating the @convex-dev/self-static-hosting component into a Convex app.\nThis component enables hosting static files (React/Vite apps) directly on Convex.\n\n## What This Component Does\n\n- Stores static files in Convex storage\n- Serves files via HTTP actions with proper MIME types\n- Supports SPA routing (fallback to index.html)\n- Smart caching: hashed assets cached forever, HTML revalidates\n- ETag support for efficient cache revalidation\n- Live reload notifications when new deployments happen\n- Optional Cloudflare CDN integration\n\n## Files to Create/Modify\n\n### 1. convex/convex.config.ts (create or modify)\n\n```typescript\nimport { defineApp } from \"convex/server\";\nimport selfStaticHosting from \"@convex-dev/self-static-hosting/convex.config\";\n\nconst app = defineApp();\napp.use(selfStaticHosting);\n\nexport default app;\n```\n\n### 2. convex/staticHosting.ts (create)\n\n```typescript\nimport { components } from \"./_generated/api\";\nimport {\n  exposeUploadApi,\n  exposeDeploymentQuery,\n  exposeCachePurgeAction,\n} from \"@convex-dev/self-static-hosting\";\n\n// Internal functions for secure uploads (only callable via CLI)\nexport const { generateUploadUrl, recordAsset, gcOldAssets, listAssets } =\n  exposeUploadApi(components.selfStaticHosting);\n\n// Public query for live reload notifications\nexport const { getCurrentDeployment } =\n  exposeDeploymentQuery(components.selfStaticHosting);\n\n// Optional: Cloudflare cache purge (for CI/CD)\nexport const { purgeCloudflareCache } = exposeCachePurgeAction();\n```\n\n### 3. convex/http.ts (create or modify)\n\n```typescript\nimport { httpRouter } from \"convex/server\";\nimport { registerStaticRoutes } from \"@convex-dev/self-static-hosting\";\nimport { components } from \"./_generated/api\";\n\nconst http = httpRouter();\n\n// Option A: Serve at root (if no other HTTP routes)\nregisterStaticRoutes(http, components.selfStaticHosting);\n\n// Option B: Serve at /app/ prefix (recommended if you have API routes)\n// registerStaticRoutes(http, components.selfStaticHosting, {\n//   pathPrefix: \"/app\",\n// });\n\n// Add other HTTP routes here if needed\n// http.route({ path: \"/api/webhook\", method: \"POST\", handler: ... });\n\nexport default http;\n```\n\n### 4. package.json scripts (add)\n\n```json\n{\n  \"scripts\": {\n    \"build\": \"vite build\",\n    \"deploy:static\": \"npx @convex-dev/self-static-hosting upload --build --prod\"\n  }\n}\n```\n\nIMPORTANT: Use `--build` flag instead of running `npm run build` separately.\nThe `--build` flag ensures `VITE_CONVEX_URL` is set correctly for the target\nenvironment (production or dev). Running build separately uses .env.local which\nhas the dev URL.\n\nFor custom domains with Cloudflare:\n```json\n{\n  \"scripts\": {\n    \"deploy:static\": \"npx @convex-dev/self-static-hosting upload --build --prod --domain yourdomain.com\"\n  }\n}\n```\n\n### 5. src/App.tsx (optional: add live reload banner)\n\n```typescript\nimport { UpdateBanner } from \"@convex-dev/self-static-hosting/react\";\nimport { api } from \"../convex/_generated/api\";\n\nfunction App() {\n  return (\n    <div>\n      {/* Shows banner when new deployment is available */}\n      <UpdateBanner\n        getCurrentDeployment={api.staticHosting.getCurrentDeployment}\n        message=\"New version available!\"\n        buttonText=\"Refresh\"\n      />\n      \n      {/* Rest of your app */}\n    </div>\n  );\n}\n```\n\nOr use the hook for custom UI:\n```typescript\nimport { useDeploymentUpdates } from \"@convex-dev/self-static-hosting/react\";\nimport { api } from \"../convex/_generated/api\";\n\nfunction App() {\n  const { updateAvailable, reload, dismiss } = useDeploymentUpdates(\n    api.staticHosting.getCurrentDeployment\n  );\n  \n  // Custom update notification UI\n}\n```\n\n## Deployment\n\n```bash\n# Login to Convex (first time)\nnpx convex login\n\n# Deploy Convex backend to production FIRST\nnpx convex deploy\n\n# Deploy static files to production\nnpm run deploy:static\n\n# Your app is now live at:\n# https://your-deployment.convex.site\n# (or https://your-deployment.convex.site/app/ if using path prefix)\n```\n\nFor development/testing:\n```bash\n# Push to dev environment\nnpx convex dev --once\n\n# Deploy static files to dev (omit --prod)\nnpx @convex-dev/self-static-hosting upload --build\n```\n\n## Optional: Cloudflare CDN with Custom Domain\n\nFor production with a custom domain, edge caching, and DDoS protection.\n\n### Quick Setup (Recommended)\n\nRun the interactive wizard:\n\n```bash\nnpx @convex-dev/self-static-hosting setup-cloudflare\n```\n\nThis wizard will:\n1. Login to Cloudflare (via wrangler)\n2. Let you select or add a domain\n3. Detect your production Convex deployment URL\n4. Configure DNS (CNAME pointing to your Convex site)\n5. Deploy a Cloudflare Worker to handle Host header rewriting\n6. Set SSL/TLS mode to \"Full\" (prevents redirect loops)\n7. Set up cache purge credentials\n8. Offer to deploy your Convex backend and static files\n\nAfter setup, deploy with:\n```bash\nnpm run deploy:static\n```\n\nThe Cloudflare cache is automatically purged on each deploy.\n\n### Manual Cloudflare Setup\n\nIf you prefer manual setup:\n\n1. Add your domain to Cloudflare\n2. Create a CNAME record pointing to your-deployment.convex.site\n3. Deploy a Cloudflare Worker to rewrite the Host header (required!)\n4. Set SSL/TLS mode to \"Full\" (not \"Flexible\")\n\nFor CI/CD, set environment variables:\n```bash\nexport CLOUDFLARE_ZONE_ID=\"your-zone-id\"\nexport CLOUDFLARE_API_TOKEN=\"your-api-token\"\nnpm run deploy:static\n```\n\n## CLI Reference\n\n```bash\nnpx @convex-dev/self-static-hosting upload [options]\n\nOptions:\n  -d, --dist <path>        Path to dist directory (default: ./dist)\n  -c, --component <name>   Convex component name (default: staticHosting)\n      --prod               Deploy to production Convex deployment\n      --dev                Deploy to dev deployment (default)\n  -b, --build              Run 'npm run build' with correct VITE_CONVEX_URL\n      --domain <name>      Custom domain for URL output and cache purge\n  -h, --help               Show help\n```\n\n## Important Notes\n\n1. The upload functions are INTERNAL - they can only be called via `npx convex run`, not from the public internet\n2. Static files are stored in the app's storage (not the component's) for proper isolation\n3. Hashed assets (e.g., main-abc123.js) get immutable caching; HTML files always revalidate\n4. The component supports SPA routing - routes without file extensions serve index.html\n5. Always use `--build` flag to ensure VITE_CONVEX_URL is set correctly for the target environment\n6. Deploy Convex backend (`npx convex deploy`) BEFORE deploying static files to production\n";
//# sourceMappingURL=init.d.ts.map